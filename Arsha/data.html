<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perkembangan Kemiskinan per Provinsi</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

    <div>
        <label for="provinsiSelect">Pilih Provinsi:</label>
        <select id="provinsiSelect"></select>

        <button onclick="updateChart()">Update Chart</button>
    </div>

    <canvas id="myChart" width="800" height="400"></canvas>

    <script>
        function readCSV(file, callback) {
            var xhr = new XMLHttpRequest();
            xhr.open("GET", file, true);
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4) {
                    if (xhr.status === 200) {
                        callback(xhr.responseText);
                    } else {
                        console.error('Failed to load CSV file.');
                    }
                }
            };
            xhr.send();
        }

        var csvFile = 'bps-od_15052_persentase_penduduk_miskin__prov_di_indonesia_data.csv';

        function processData(csvData) {
            var rows = csvData.split('\r');
            var labels = rows[0].split(',');

            var data = [];
            for (var i = 1; i < rows.length; i++) {
                var values = rows[i].split(',');

                // Skip empty lines or lines with fewer values
                if (values.length !== labels.length) {
                    continue;
                }

                var rowObject = {};
                for (var j = 0; j < values.length; j++) {
                    rowObject[labels[j]] = values[j];
                }
                data.push(rowObject);
            }

            var uniqueProvinces = [...new Set(data.map(item => item.nama_provinsi))];
            var provinsiSelect = document.getElementById('provinsiSelect');

            uniqueProvinces.forEach(provinsi => {
                var option = document.createElement('option');
                option.value = provinsi;
                option.text = provinsi;
                provinsiSelect.add(option);
            });

            var selectedProvinsi = uniqueProvinces[0];

            var ctx = document.getElementById('myChart').getContext('2d');
            var myChart;

            window.updateChart = function () {
                selectedProvinsi = provinsiSelect.value;

                var filteredData = data.filter(item => item.nama_provinsi === selectedProvinsi);

                if (myChart) {
                    myChart.destroy();
                }

                myChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: filteredData.map(item => `${item.tahun} ${item.semester}`),
                        datasets: [{
                            label: `Perkembangan Kemiskinan - ${selectedProvinsi}`,
                            data: filteredData.map(item => parseFloat(item.penduduk_miskin)),
                            backgroundColor: 'rgba(75, 192, 192, 0.2)',
                            borderColor: 'rgba(75, 192, 192, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 35
                            }
                        }
                    }
                });
            }

            window.updateChart(); // Panggil updateChart() untuk menginisialisasi grafik
        }

        readCSV(csvFile, processData);
    </script>

</body>

</html>